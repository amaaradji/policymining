#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Package Evaluation Materials for Overleaf

Creates a clean package with evaluation.tex and all figures ready to
copy directly into an Overleaf project.

Author: Research Assistant
Date: October 2025
"""

import shutil
from pathlib import Path
import sys

def main():
    """Package evaluation materials for Overleaf"""

    base_dir = Path(__file__).parent.parent
    paper_sections = base_dir / 'paper_sections'
    overleaf_dir = base_dir / 'overleaf_package'

    # Create fresh package directory
    if overleaf_dir.exists():
        shutil.rmtree(overleaf_dir)

    overleaf_dir.mkdir(parents=True)

    print("="*80)
    print("PACKAGING FOR OVERLEAF")
    print("="*80)

    # Copy evaluation.tex
    eval_tex = paper_sections / 'evaluation.tex'
    if eval_tex.exists():
        shutil.copy(eval_tex, overleaf_dir / 'evaluation.tex')
        print(f"\n‚úì Copied: evaluation.tex")
    else:
        print(f"\n‚úó Missing: evaluation.tex")
        return 1

    # Copy all PDF figures
    pdf_figures = list(paper_sections.glob('figure*.pdf'))
    if pdf_figures:
        print(f"\n‚úì Copying {len(pdf_figures)} PDF figures:")
        for fig in pdf_figures:
            shutil.copy(fig, overleaf_dir / fig.name)
            print(f"  - {fig.name}")
    else:
        print("\n‚ö† Warning: No PDF figures found")
        print("  Run: python experiments/analyze_results.py")

    # Copy PNG versions (for preview/backup)
    png_figures = list(paper_sections.glob('figure*.png'))
    if png_figures:
        print(f"\n‚úì Copying {len(png_figures)} PNG figures (for preview):")
        for fig in png_figures:
            shutil.copy(fig, overleaf_dir / fig.name)
            print(f"  - {fig.name}")

    # Copy LaTeX tables
    tex_tables = list(paper_sections.glob('table*.tex'))
    if tex_tables:
        print(f"\n‚úì Copying {len(tex_tables)} LaTeX tables:")
        for table in tex_tables:
            shutil.copy(table, overleaf_dir / table.name)
            print(f"  - {table.name}")

    # Create README for Overleaf
    readme_content = """# Evaluation Section for Overleaf

This package contains the complete evaluation section for your research paper.

## Contents

- `evaluation.tex` - Complete evaluation section (Section 5)
- `figure*.pdf` - All figures in PDF format (for LaTeX)
- `figure*.png` - Preview versions (not needed for LaTeX)
- `table*.tex` - LaTeX tables

## Usage in Overleaf

1. Upload all files to your Overleaf project
2. In your main document, include the evaluation section:

```latex
\\input{evaluation}
```

Or copy the contents of evaluation.tex directly into your document.

## Figure References

The evaluation.tex file references figures as:
- `paper_sections/figure1_policy_comparison.pdf`
- `paper_sections/figure2_violation_sensitivity.pdf`
- `paper_sections/figure3_confusion_matrices.pdf`
- `paper_sections/figure4_scalability.pdf`

**Important**: Either:
- Option A: Create a `paper_sections/` folder in Overleaf and upload figures there
- Option B: Edit evaluation.tex to remove `paper_sections/` prefix from figure paths

## Recommended: Option B

Search and replace in evaluation.tex:
```
paper_sections/ ‚Üí (empty)
```

This way figures can be in the root of your Overleaf project.

## Citation

Remember to add the BPI Challenge 2017 citation to your bibliography:

```bibtex
@misc{vanDongen2017,
  author = {van Dongen, B.F.},
  title = {BPI Challenge 2017},
  year = {2017},
  publisher = {4TU.ResearchData},
  doi = {10.4121/uuid:5f3067df-f10b-45da-b98b-86ae4c7a310b}
}
```

Generated by Policy Mining Evaluation Framework
"""

    with open(overleaf_dir / 'README.txt', 'w') as f:
        f.write(readme_content)

    print("\n‚úì Created: README.txt")

    # Summary
    print("\n" + "="*80)
    print("PACKAGE SUMMARY")
    print("="*80)

    all_files = list(overleaf_dir.glob('*'))
    print(f"\nTotal files: {len(all_files)}")
    print(f"Location: {overleaf_dir}")

    print("\nüì¶ Package contents:")
    for f in sorted(all_files):
        size_kb = f.stat().st_size / 1024
        print(f"  - {f.name:<40} ({size_kb:>8.1f} KB)")

    print("\n" + "="*80)
    print("‚úì PACKAGING COMPLETE")
    print("="*80)

    print(f"\nüìÅ Package ready at: {overleaf_dir}")
    print("\nüì§ Next steps:")
    print("   1. Zip the overleaf_package/ folder")
    print("   2. Upload to your Overleaf project")
    print("   3. Adjust figure paths if needed (see README.txt)")
    print("   4. Compile and review!")

    return 0

if __name__ == '__main__':
    sys.exit(main())
